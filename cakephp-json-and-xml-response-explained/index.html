<!DOCTYPE html><!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"><![endif]--><!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]--><!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]--><!--[if gt IE 8]><!--><html class=no-js lang=en><!--<![endif]--><head><meta charset=utf-8><title>CakePHP - JSON and XML response explained &#8211; I am Yihang</title><meta name=description content="The hows why trying to respond with JSON and XML in CakePHP"><meta name=keywords content="Web development, CakePHP, JSON, XML"><meta name=twitter:card content=summary><meta name=twitter:image content="http://www.yihangho.com/images/"><meta name=twitter:title content="CakePHP - JSON and XML response explained"><meta name=twitter:description content="The hows why trying to respond with JSON and XML in CakePHP"><meta name=twitter:creator content=@yihang5><meta property=og:locale content=en_US><meta property=og:type content=article><meta property=og:title content="CakePHP - JSON and XML response explained"><meta property=og:description content="The hows why trying to respond with JSON and XML in CakePHP"><meta property=og:url content=http://www.yihangho.com/cakephp-json-and-xml-response-explained><meta property=og:site_name content="I am Yihang"><link rel=canonical href=http://www.yihangho.com/cakephp-json-and-xml-response-explained><link href=http://www.yihangho.com/feed.xml type=application/atom+xml rel=alternate title="I am Yihang Feed"><link rel=author href="https://plus.google.com/+YihangHo/?rel=author"><meta name=HandheldFriendly content=True><meta name=MobileOptimized content=320><meta name=viewport content="width=device-width, initial-scale=1.0"><link href="http://fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700|PT+Serif:400,700,400italic" rel=stylesheet><link rel=stylesheet href=http://www.yihangho.com/assets/css/main.min.css><!--[if (lt IE 9) & (!IEMobile)]><link rel="stylesheet" href="http://www.yihangho.com/assets/css/ie.min.css"><![endif]--><meta http-equiv=cleartype content=on><script src=http://www.yihangho.com/assets/js/vendor/modernizr-2.6.2.custom.min.js></script><body class=article itemscope itemtype=http://schema.org/WebPage><!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]--><div class=navigation-wrapper><div class=site-name><a href=http://www.yihangho.com>I am Yihang</a></div><div class=top-navigation><nav role=navigation itemscope itemtype=http://schema.org/SiteNavigationElement><ul><li><a href=http://www.yihangho.com/about>About</a></li><li><a href=http://www.yihangho.com/articles>Articles</a></li><li><a href=http://www.yihangho.com/apps>Apps</a></li><li><i class=icon-feed></i> <a href=http://www.yihangho.com/feed.xml title="Atom/RSS feed">Feed</a></li></ul></nav></div></div><div id=main role=main itemprop=mainContentOfPage itemscope itemtype=http://schema.org/Blog><div class=article-author-top><img src=http://www.yihangho.com/images/bio-photo.jpg class=bio-photo alt="Yihang Ho bio photo"><h3>Yihang Ho</h3><p>Coder</p><a href=http://twitter.com/yihang5 class=author-social target=_blank><i class=icon-twitter></i> Twitter</a> <a href=http://facebook.com/yihangho class=author-social target=_blank><i class=icon-facebook></i> Facebook</a> <a href="https://plus.google.com/+YihangHo/" class=author-social target=_blank><i class=icon-google-plus></i> Google+</a> <a href=http://github.com/yihangho class=author-social target=_blank><i class=icon-github></i> Github</a> <a href=mailto:me@yihangho.com class=author-social target=_blank><i class=icon-mail></i> Email</a></div><article itemscope itemtype=http://schema.org/BlogPosting itemprop=blogPost><div class=headline-wrap><h1 itemprop=name>CakePHP - JSON and XML response explained</h1><h2></h2></div><div class=article-wrap itemprop=text><p>I’ve been trying out <a href="http://cakephp.org/">CakePHP</a> lately. The <a href=http://book.cakephp.org/2.0/en/tutorials-and-examples/blog/blog.html>getting started tutorial</a> is very beginner-friendly. However, the <a href=http://book.cakephp.org/2.0/en/views/json-and-xml-views.html>guide</a> on JSON and XML views is not very clear. After fooling around a bit, I finally figured out how it works.</p><h2 id=making-request>Making request</h2><p>A single action can be made to respond the beautiful HTML, and also machine-readable JSON and XML. For example, to access the <code>index</code> action of the <code>posts</code> controller, we usually request for <a href=http://www.example.com/posts/index>http://www.example.com/posts/index</a>. To request for the JSON or XML version, simply append <code>.json</code> or <code>.xml</code> to the end of the action name. For example, <a href=http://www.example.com/posts/index.json>http://www.example.com/posts/index.json</a> or <a href=http://www.example.com/posts/index.xml>http://www.example.com/posts/index.xml</a>. Besides that, you can also add <code>Accept: application/json</code> or <code>Accept: application/xml</code> into the request header with or without appending <code>.json</code> or <code>.xml</code> to the action name. This can be simulated using curl:</p><pre><code class=language-bash>curl -H Accept:application/json http://www.example.com/posts/index
# or
curl -H Accept:application/xml http://www.example.com/posts/index
</code></pre><h2 id=configuration>Configuration</h2><p>We need to tell CakePHP and the controllers involved to accept and process JSON and XML request. First, add</p><pre><code class=language-php>Router::parseExtensions('json', 'xml');
</code></pre><p>into <code>app/Config/routes.php</code>. Also, inside the class definition of all the controllers involved (for example in <code>app/Controller/PostsController.php</code>), insert</p><pre><code class=language-php>public $components = array('RequestHandler');
</code></pre><p>In general, there are two ways to ‘tell’ CakePHP how to output the JSON and XML when requested. First method is easier and does not involve another view for JSON and XML; the other does.</p><h2 id=using-serialize-key>Using serialize key</h2><p>Suppose we want to encode the following array into JSON and XML:</p><pre><code class=language-php>$output = array(
	"status" =&gt; "OK",
	"message" =&gt; "You are good",
	"content" =&gt; $content
);
</code></pre><p>We need to first <code>set()</code> all the keys in the array:</p><pre><code class=language-php>$this-&gt;set("status", "OK");
$this-&gt;set("message", "You are good");
$this-&gt;set("content", $content);
// Can also set() other variables that might not be used in the JSON or XML string
$this-&gt;set("other", "something");
$this-&gt;set("stuff", "else");
// or simply
$this-&gt;set($output);
</code></pre><p>and then tell CakePHP which keys should appear in the output array:</p><pre><code class=language-php>$this-&gt;set("_serialize", array("status", "message", "content"));
</code></pre><p>Notice that other variables set with <code>set()</code> method will not appear in the JSON or XML output unless they are inside <code>_serialize</code>d array. Now, if you visit <code>index.json</code> or <code>index.xml</code> you can see the output equivalent to <code>json_encode($output, JSON_PRETTY_PRINT);</code></p><h2 id=using-views>Using views</h2><p>I guess for most of the time, the method that does not involve a view should be sufficient. Other times, for example, if you want some data to appear in the HTML version, but not on the JSON and XML version, you might do the necessary data processing in the view. The views for JSON and XML are defined in <code>app/Views/&lt;controller name&gt;/&lt;json or xml&gt;/&lt;action name&gt;.ctp</code>. For example, <code>app/Views/Posts/json/index.ctp</code>. To enable the views for JSON and XML, you <em>have</em> to <strong>disable</strong> <code>$this-&gt;set("_serialize", array(...));</code>. Also, the view <strong>must</strong> generate a <strong>valid</strong> JSON or XML string, or else CakePHP will throw an error.</p><pre><code class=language-php>// app/Controller/PostsController.php
public function index() {
	$this-&gt;set('posts', $this-&gt;Post-&gt;find('all'));
}
</code></pre><pre><code class=language-php>// app/Views/Posts/json/index.ctp
&lt;?php
for ($i=0; $i&lt;count($posts); $i++)
{
    unset($posts[$i]["Post"]["created"]);
    unset($posts[$i]["Post"]["modified"]);
}
json_encode($posts);
?&gt;
</code></pre><h2 id=example-code>Example code</h2><p>I have prepared a piece of example code as a continuation of the blog tutorial. The code is available <a href=https://github.com/yihangho/cakephp-json-xml-response>here</a>. You may <code>git checkout no-view</code> or <code>git checkout custom-view</code> to see the actual code for the serialize key method and custom view method.</p><div style=text-align:center><p><div data-selector=div.article-wrap data-options={} data-role=spritzer></div></p></div><hr><footer role=contentinfo><div class=article-author-bottom><img src=http://www.yihangho.com/images/bio-photo.jpg class=bio-photo alt="Yihang Ho bio photo"><h3>Yihang Ho</h3><p>Coder</p><a href=http://twitter.com/yihang5 class=author-social target=_blank><i class=icon-twitter></i> Twitter</a> <a href=http://facebook.com/yihangho class=author-social target=_blank><i class=icon-facebook></i> Facebook</a> <a href="https://plus.google.com/+YihangHo/" class=author-social target=_blank><i class=icon-google-plus></i> Google+</a> <a href=http://github.com/yihangho class=author-social target=_blank><i class=icon-github></i> Github</a> <a href=mailto:me@yihangho.com class=author-social target=_blank><i class=icon-mail></i> Email</a></div><p class=byline><strong>CakePHP - JSON and XML response explained</strong> was published on <time datetime=2013-09-04T00:00:00+08:00 itemprop=datePublished>September 04, 2013</time> and last modified on <time datetime=2013-11-05 itemprop=dateModified>November 05, 2013</time> by <span itemprop=author itemscope itemtype=http://schema.org/Person><span itemprop=name><a href=http://www.yihangho.com/about title="About Yihang Ho" itemprop=url>Yihang Ho</a></span></span>.</p></footer></div></article></div><div class=footer-wrap><div class=related-articles><h4>You might also enjoy <small class=pull-right>(<a href=http://www.yihangho.com/articles>View all articles</a>)</small></h4><ul><li><a href=http://www.yihangho.com/bezier title=Bézier>Bézier</a></li><li><a href=http://www.yihangho.com/spritz-for-jekyll title="Spritz for Jekyll">Spritz for Jekyll</a></li><li><a href=http://www.yihangho.com/biology-and-computer-science title="Biology and Computer Science">Biology and Computer Science</a></li></ul><hr></div><footer><span>&copy; 2014 Yihang Ho. Powered by <a href=http://jekyllrb.com>Jekyll</a> using the <a href="http://mademistakes.com/">Minimal Mistakes</a> theme.</span></footer></div><script src=//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js></script><script>window.jQuery || document.write('<script src="http://www.yihangho.com/assets/js/vendor/jquery-1.11.0.min.js"><\/script>')</script><script src=http://www.yihangho.com/assets/js/scripts.min.js></script><script>window.jQuery || document.write('<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js">\x3C/script>');
var SpritzSettings = {
clientId: "1e621458778214a7c",
redirectUri: "http://www.yihangho.com/login_success.html"
};
if (!(/^https?:\/\//i.test(SpritzSettings.redirectUri))) {
SpritzSettings.redirectUri = window.location.protocol + "//" + window.location.host + SpritzSettings.redirectUri;
}</script><script id=spritzjs src=//sdk.spritzinc.com/js/1.0/js/spritz.min.js></script><script>var _paq=_paq||[];_paq.push(["trackPageView"]);_paq.push(["enableLinkTracking"]);(function(){var u=(("https:"==document.location.protocol)?"https":"http")+"://piwik-yihangho.rhcloud.com/";_paq.push(["setTrackerUrl",u+"piwik.php"]);_paq.push(["setSiteId","1"]);var d=document,g=d.createElement("script"),s=d.getElementsByTagName("script")[0];g.type="text/javascript";g.defer=true;g.async=true;g.src=u+"piwik.js";s.parentNode.insertBefore(g,s)})();</script>